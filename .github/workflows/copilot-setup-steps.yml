name: Copilot Setup Steps
"on":
  pull_request:
    paths:
    - .github/workflows/copilot-setup-steps.yml
  push:
    paths:
    - .github/workflows/copilot-setup-steps.yml
  workflow_dispatch: null
jobs:
  copilot-setup-steps:
    runs-on: ubuntu-latest
    env:
      NUMBA_ENABLE_CUDASIM: "1"
    permissions:
      contents: read
    steps:
    - name: Install gh-aw extension
      run: curl -fsSL https://raw.githubusercontent.com/githubnext/gh-aw/refs/heads/main/install-gh-aw.sh | bash
    - name: Verify gh-aw installation
      run: gh aw version
    - name: Checkout code
      uses: actions/checkout@v4
    - name: Set up Python
      uses: actions/setup-python@v4
      with:
        cache: pip
        python-version: "3.12"
    - name: Install Python dependencies
      run: |
        python -m pip install --upgrade pip uv
        python -m uv pip install --system -r ci/requirements.ci.txt
        python -m uv pip install --system -e .[dev]
    - name: Replace numba-cuda with forked branch
      run: |
        python -m pip uninstall -y numba-cuda || true
        git clone --branch cubie_patch https://github.com/ccam80/numba-cuda.git /tmp/numba-cuda
        cd /tmp/numba-cuda
        python -m uv pip install -e .
        cd "$GITHUB_WORKSPACE"
