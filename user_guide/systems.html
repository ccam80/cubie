

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Creating a “System” of Differential Equations &mdash; cubie 0.0.4 documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="../_static/custom.css?v=1b720227" />

  
      <script src="../_static/jquery.js?v=5d32c60e"></script>
      <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../_static/documentation_options.js?v=8c5712d9"></script>
      <script src="../_static/doctools.js?v=9bcbadda"></script>
      <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Drivers (Time-dependent functions)" href="drivers.html" />
    <link rel="prev" title="User Manual" href="index.html" /> 
<meta name="google-site-verification" content="Fpgkmgu5X-0RRG9UUYo4erbY0wd7VmLIQU4UZv_YaXc" />
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            cubie
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../getting_started.html">Getting Started with Cubie</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">User Manual</a><ul class="current">
<li class="toctree-l2 current"><a class="current reference internal" href="#">Creating a “System” of Differential Equations</a></li>
<li class="toctree-l2"><a class="reference internal" href="drivers.html">Drivers (Time-dependent functions)</a></li>
<li class="toctree-l2"><a class="reference internal" href="algorithms.html">ODE solving algorithms</a></li>
<li class="toctree-l2"><a class="reference internal" href="speed.html">Making it Faster</a></li>
<li class="toctree-l2"><a class="reference internal" href="cuda.html">Using CUDA for IVPs</a></li>
<li class="toctree-l2"><a class="reference internal" href="userfunctions.html">User functions and derivatives</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../API_reference/index.html">Reference Manual</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../API_reference/batchsolving/index.html">Batch solving</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../API_reference/batchsolving/solver.html">Solver</a></li>
<li class="toctree-l3"><a class="reference internal" href="../API_reference/batchsolving/solve_ivp.html">solve_ivp</a></li>
<li class="toctree-l3"><a class="reference internal" href="../API_reference/batchsolving/solve_result.html">SolveResult</a></li>
<li class="toctree-l3"><a class="reference internal" href="../API_reference/batchsolving/solve_spec.html">SolveSpec</a></li>
<li class="toctree-l3"><a class="reference internal" href="../API_reference/batchsolving/batch_grid_builder.html">BatchGridBuilder</a></li>
<li class="toctree-l3"><a class="reference internal" href="../API_reference/batchsolving/batch_solver_config.html">BatchSolverConfig</a></li>
<li class="toctree-l3"><a class="reference internal" href="../API_reference/batchsolving/batch_solver_kernel.html">BatchSolverKernel</a></li>
<li class="toctree-l3"><a class="reference internal" href="../API_reference/batchsolving/system_interface.html">SystemInterface</a></li>
<li class="toctree-l3"><a class="reference internal" href="../API_reference/batchsolving/cuda_array_validator.html">cuda_array_validator</a></li>
<li class="toctree-l3"><a class="reference internal" href="../API_reference/batchsolving/cuda_array_validator_2d.html">cuda_array_validator_2d</a></li>
<li class="toctree-l3"><a class="reference internal" href="../API_reference/batchsolving/cuda_array_validator_3d.html">cuda_array_validator_3d</a></li>
<li class="toctree-l3"><a class="reference internal" href="../API_reference/batchsolving/optional_cuda_array_validator.html">optional_cuda_array_validator</a></li>
<li class="toctree-l3"><a class="reference internal" href="../API_reference/batchsolving/optional_cuda_array_validator_2d.html">optional_cuda_array_validator_2d</a></li>
<li class="toctree-l3"><a class="reference internal" href="../API_reference/batchsolving/optional_cuda_array_validator_3d.html">optional_cuda_array_validator_3d</a></li>
<li class="toctree-l3"><a class="reference internal" href="../API_reference/batchsolving/arrays.html">Arrays</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../API_reference/batchsolving/array_container.html">ArrayContainer</a></li>
<li class="toctree-l4"><a class="reference internal" href="../API_reference/batchsolving/base_array_manager.html">BaseArrayManager</a></li>
<li class="toctree-l4"><a class="reference internal" href="../API_reference/batchsolving/managed_array.html">ManagedArray</a></li>
<li class="toctree-l4"><a class="reference internal" href="../API_reference/batchsolving/input_array_container.html">InputArrayContainer</a></li>
<li class="toctree-l4"><a class="reference internal" href="../API_reference/batchsolving/input_arrays.html">InputArrays</a></li>
<li class="toctree-l4"><a class="reference internal" href="../API_reference/batchsolving/output_array_container.html">OutputArrayContainer</a></li>
<li class="toctree-l4"><a class="reference internal" href="../API_reference/batchsolving/active_outputs.html">ActiveOutputs</a></li>
<li class="toctree-l4"><a class="reference internal" href="../API_reference/batchsolving/output_arrays.html">OutputArrays</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../API_reference/odesystems/index.html">ODE systems</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../API_reference/odesystems/create_ode_system.html">create_ODE_system</a></li>
<li class="toctree-l3"><a class="reference internal" href="../API_reference/odesystems/symbolic_ode.html">SymbolicODE</a></li>
<li class="toctree-l3"><a class="reference internal" href="../API_reference/odesystems/base_ode.html">BaseODE</a></li>
<li class="toctree-l3"><a class="reference internal" href="../API_reference/odesystems/ode_data.html">ODEData</a></li>
<li class="toctree-l3"><a class="reference internal" href="../API_reference/odesystems/system_values.html">SystemValues</a></li>
<li class="toctree-l3"><a class="reference internal" href="../API_reference/odesystems/system_sizes.html">SystemSizes</a></li>
<li class="toctree-l3"><a class="reference internal" href="../API_reference/odesystems/ode_cache.html">ODECache</a></li>
<li class="toctree-l3"><a class="reference internal" href="../API_reference/odesystems/symbolic.html">Symbolic</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../API_reference/integrators/index.html">Integrators</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../API_reference/integrators/single_integrator_run.html">SingleIntegratorRun</a></li>
<li class="toctree-l3"><a class="reference internal" href="../API_reference/integrators/integrator_return_codes.html">IntegratorReturnCodes</a></li>
<li class="toctree-l3"><a class="reference internal" href="../API_reference/integrators/algorithms.html">Algorithms</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../API_reference/integrators/algorithms/base_step_config.html">BaseStepConfig</a></li>
<li class="toctree-l4"><a class="reference internal" href="../API_reference/integrators/algorithms/base_algorithm_step.html">BaseAlgorithmStep</a></li>
<li class="toctree-l4"><a class="reference internal" href="../API_reference/integrators/algorithms/step_cache.html">StepCache</a></li>
<li class="toctree-l4"><a class="reference internal" href="../API_reference/integrators/algorithms/explicit_step_config.html">ExplicitStepConfig</a></li>
<li class="toctree-l4"><a class="reference internal" href="../API_reference/integrators/algorithms/explicit_euler_step.html">ExplicitEulerStep</a></li>
<li class="toctree-l4"><a class="reference internal" href="../API_reference/integrators/algorithms/implicit_step_config.html">ImplicitStepConfig</a></li>
<li class="toctree-l4"><a class="reference internal" href="../API_reference/integrators/algorithms/backwards_euler_step.html">BackwardsEulerStep</a></li>
<li class="toctree-l4"><a class="reference internal" href="../API_reference/integrators/algorithms/backwards_euler_pc_step.html">BackwardsEulerPCStep</a></li>
<li class="toctree-l4"><a class="reference internal" href="../API_reference/integrators/algorithms/crank_nicolson_step.html">CrankNicolsonStep</a></li>
<li class="toctree-l4"><a class="reference internal" href="../API_reference/integrators/algorithms/generic_erk_step.html">ERKStep</a></li>
<li class="toctree-l4"><a class="reference internal" href="../API_reference/integrators/algorithms/generic_erk_tableaus.html">ERK tableau registry</a></li>
<li class="toctree-l4"><a class="reference internal" href="../API_reference/integrators/algorithms/generic_dirk_step.html">DIRKStep</a></li>
<li class="toctree-l4"><a class="reference internal" href="../API_reference/integrators/algorithms/generic_dirk_tableaus.html">DIRK tableau registry</a></li>
<li class="toctree-l4"><a class="reference internal" href="../API_reference/integrators/algorithms/get_algorithm_step.html">get_algorithm_step</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../API_reference/integrators/loops.html">Loops</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../API_reference/integrators/loops/ivp_loop.html">IVPLoop</a></li>
<li class="toctree-l4"><a class="reference internal" href="../API_reference/integrators/loops/ode_loop_config.html">ODELoopConfig</a></li>
<li class="toctree-l4"><a class="reference internal" href="../API_reference/integrators/loops/loop_shared_indices.html">LoopSharedIndices</a></li>
<li class="toctree-l4"><a class="reference internal" href="../API_reference/integrators/loops/loop_local_indices.html">LoopLocalIndices</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../API_reference/integrators/matrix_free_solvers.html">Matrix-free solvers</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../API_reference/integrators/matrix_free_solvers/linear_solver_factory.html">linear_solver_factory</a></li>
<li class="toctree-l4"><a class="reference internal" href="../API_reference/integrators/matrix_free_solvers/newton_krylov_solver_factory.html">newton_krylov_solver_factory</a></li>
<li class="toctree-l4"><a class="reference internal" href="../API_reference/integrators/matrix_free_solvers/solver_ret_codes.html">SolverRetCodes</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../API_reference/integrators/step_control.html">Step control</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../API_reference/integrators/step_control/get_controller.html">get_controller</a></li>
<li class="toctree-l4"><a class="reference internal" href="../API_reference/integrators/step_control/base_step_controller.html">BaseStepController</a></li>
<li class="toctree-l4"><a class="reference internal" href="../API_reference/integrators/step_control/base_adaptive_step_controller.html">BaseAdaptiveStepController</a></li>
<li class="toctree-l4"><a class="reference internal" href="../API_reference/integrators/step_control/fixed_step_controller.html">FixedStepController</a></li>
<li class="toctree-l4"><a class="reference internal" href="../API_reference/integrators/step_control/adaptive_i_controller.html">AdaptiveIController</a></li>
<li class="toctree-l4"><a class="reference internal" href="../API_reference/integrators/step_control/adaptive_pi_controller.html">AdaptivePIController</a></li>
<li class="toctree-l4"><a class="reference internal" href="../API_reference/integrators/step_control/adaptive_pid_controller.html">AdaptivePIDController</a></li>
<li class="toctree-l4"><a class="reference internal" href="../API_reference/integrators/step_control/gustafsson_controller.html">GustafssonController</a></li>
<li class="toctree-l4"><a class="reference internal" href="../API_reference/integrators/step_control/base_step_controller_config.html">BaseStepControllerConfig</a></li>
<li class="toctree-l4"><a class="reference internal" href="../API_reference/integrators/step_control/adaptive_step_control_config.html">AdaptiveStepControlConfig</a></li>
<li class="toctree-l4"><a class="reference internal" href="../API_reference/integrators/step_control/fixed_step_control_config.html">FixedStepControlConfig</a></li>
<li class="toctree-l4"><a class="reference internal" href="../API_reference/integrators/step_control/pi_step_control_config.html">PIStepControlConfig</a></li>
<li class="toctree-l4"><a class="reference internal" href="../API_reference/integrators/step_control/pid_step_control_config.html">PIDStepControlConfig</a></li>
<li class="toctree-l4"><a class="reference internal" href="../API_reference/integrators/step_control/gustafsson_step_control_config.html">GustafssonStepControlConfig</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../API_reference/outputhandling/index.html">Output handling</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../API_reference/outputhandling/output_functions.html">OutputFunctions</a></li>
<li class="toctree-l3"><a class="reference internal" href="../API_reference/outputhandling/output_config.html">OutputConfig</a></li>
<li class="toctree-l3"><a class="reference internal" href="../API_reference/outputhandling/output_compile_flags.html">OutputCompileFlags</a></li>
<li class="toctree-l3"><a class="reference internal" href="../API_reference/outputhandling/summaries_buffer_sizes.html">SummariesBufferSizes</a></li>
<li class="toctree-l3"><a class="reference internal" href="../API_reference/outputhandling/loop_buffer_sizes.html">LoopBufferSizes</a></li>
<li class="toctree-l3"><a class="reference internal" href="../API_reference/outputhandling/output_array_heights.html">OutputArrayHeights</a></li>
<li class="toctree-l3"><a class="reference internal" href="../API_reference/outputhandling/single_run_output_sizes.html">SingleRunOutputSizes</a></li>
<li class="toctree-l3"><a class="reference internal" href="../API_reference/outputhandling/batch_input_sizes.html">BatchInputSizes</a></li>
<li class="toctree-l3"><a class="reference internal" href="../API_reference/outputhandling/batch_output_sizes.html">BatchOutputSizes</a></li>
<li class="toctree-l3"><a class="reference internal" href="../API_reference/outputhandling/output_function_cache.html">OutputFunctionCache</a></li>
<li class="toctree-l3"><a class="reference internal" href="../API_reference/outputhandling/summary_metrics.html">summary_metrics</a></li>
<li class="toctree-l3"><a class="reference internal" href="../API_reference/outputhandling/register_metric.html">register_metric</a></li>
<li class="toctree-l3"><a class="reference internal" href="../API_reference/outputhandling/summarymetrics.html">Summary metrics</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../API_reference/outputhandling/summary_metrics.html">summary_metrics</a></li>
<li class="toctree-l4"><a class="reference internal" href="../API_reference/outputhandling/register_metric.html">register_metric</a></li>
<li class="toctree-l4"><a class="reference internal" href="../API_reference/outputhandling/summarymetrics/metrics/summary_metric.html">SummaryMetric</a></li>
<li class="toctree-l4"><a class="reference internal" href="../API_reference/outputhandling/summarymetrics/metrics/summary_metrics.html">SummaryMetrics</a></li>
<li class="toctree-l4"><a class="reference internal" href="../API_reference/outputhandling/summarymetrics/metrics/metric_func_cache.html">MetricFuncCache</a></li>
<li class="toctree-l4"><a class="reference internal" href="../API_reference/outputhandling/summarymetrics/metrics/mean.html">Mean</a></li>
<li class="toctree-l4"><a class="reference internal" href="../API_reference/outputhandling/summarymetrics/metrics/max.html">Max</a></li>
<li class="toctree-l4"><a class="reference internal" href="../API_reference/outputhandling/summarymetrics/metrics/rms.html">RMS</a></li>
<li class="toctree-l4"><a class="reference internal" href="../API_reference/outputhandling/summarymetrics/metrics/peaks.html">Peaks</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../API_reference/memory.html">Memory</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../API_reference/memory/default_memmgr.html">default_memmgr</a></li>
<li class="toctree-l3"><a class="reference internal" href="../API_reference/memory/memory_manager.html">MemoryManager</a></li>
<li class="toctree-l3"><a class="reference internal" href="../API_reference/memory/array_request.html">ArrayRequest</a></li>
<li class="toctree-l3"><a class="reference internal" href="../API_reference/memory/array_response.html">ArrayResponse</a></li>
<li class="toctree-l3"><a class="reference internal" href="../API_reference/memory/stream_groups.html">StreamGroups</a></li>
<li class="toctree-l3"><a class="reference internal" href="../API_reference/memory/current_cupy_stream.html">current_cupy_stream</a></li>
<li class="toctree-l3"><a class="reference internal" href="../API_reference/memory/cupy_async_numba_manager.html">CuPyAsyncNumbaManager</a></li>
<li class="toctree-l3"><a class="reference internal" href="../API_reference/memory/cupy_sync_numba_manager.html">CuPySyncNumbaManager</a></li>
</ul>
</li>
</ul>
</li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">cubie</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="index.html">User Manual</a></li>
      <li class="breadcrumb-item active">Creating a “System” of Differential Equations</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/user_guide/systems.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="creating-a-system-of-differential-equations">
<h1>Creating a “System” of Differential Equations<a class="headerlink" href="#creating-a-system-of-differential-equations" title="Link to this heading"></a></h1>
<p>The first step in solving a system of differential equations is to create a
system of differential equations. Cubie understands ODEs in the form of a
<a class="reference internal" href="../API_reference/odesystems/base_ode.html#cubie.odesystems.BaseODE" title="cubie.odesystems.baseODE.BaseODE"><code class="xref py py-class docutils literal notranslate"><span class="pre">GenericODE</span></code></a> object, which holds the
(frac{dx}{dt}) equations and descriptions and default values for all of the
variables that those equations depend on.</p>
<p>Cubie uses SymPy to parse a system defined in strings, and generates a special
version of a <a class="reference internal" href="../API_reference/odesystems/base_ode.html#cubie.odesystems.BaseODE" title="cubie.odesystems.baseODE.BaseODE"><code class="xref py py-class docutils literal notranslate"><span class="pre">GenericODE</span></code></a> called a
<a class="reference internal" href="../API_reference/odesystems/symbolic_ode.html#cubie.odesystems.SymbolicODE" title="cubie.odesystems.symbolic.symbolicODE.SymbolicODE"><code class="xref py py-class docutils literal notranslate"><span class="pre">SymbolicODE</span></code></a>, which
does some extra tricks to produce extra helper functions for the integration
algorithms to use. This is the easiest way to create a system of ODEs. Here’s an
example of setting up the Lotka-Volterra predator-prey equations, a common
example of a nonlinear ODE system:</p>
<p><code class="docutils literal notranslate"><span class="pre">BaseODE</span></code> is the abstract interface, and <code class="docutils literal notranslate"><span class="pre">SymbolicODE</span></code> is currently its
only concrete subclass.</p>
<div class="literal-block-wrapper docutils container" id="id1">
<div class="code-block-caption"><span class="caption-text">The simplest way to create a system of ODEs in Cubie.</span><a class="headerlink" href="#id1" title="Link to this code"></a></div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">cubie</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">qb</span>

<span class="n">LV</span> <span class="o">=</span> <span class="n">qb</span><span class="o">.</span><span class="n">create_ODE_system</span><span class="p">(</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    dx = a*x - b*x*y</span>
<span class="sd">    dy = -c*y + d*x*y</span>
<span class="sd">    &quot;&quot;&quot;</span><span class="p">,</span>
<span class="n">name</span><span class="o">=</span><span class="s2">&quot;LotkaVolterra&quot;</span><span class="p">,</span>
<span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">LV</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>In this example, Cubie has determined that x and y are state variables, as they
have (frac{dx}{dt}) equations. (frac{dx}{dr}) equations must start with a
“d” followed by the variable name. The variables a, b, c, and d have been called
“parameters”, as they don’t have (frac{dx}{dt}) equations, and they don’t
appear on the left-hand side of any equations. Parameters are inputs to the
system that are expected to change between different runs of the solve; alongside
the initial values of the state variables, they form the input variables to a
batch solver run. If any of your non-state input variables are not expected to
change inside each batch, you can mark them as “constants” instead. This will
typically speed up the solving process and allow you to run more IVPs in a single
batch, as Cubie doesn’t need to worry about finding a place in memory for them.
To achieve this, we might modify the above example to:</p>
<div class="literal-block-wrapper docutils container" id="id2">
<div class="code-block-caption"><span class="caption-text">Creating a system of ODEs with constants.</span><a class="headerlink" href="#id2" title="Link to this code"></a></div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">cubie</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">qb</span>

<span class="n">LV</span> <span class="o">=</span> <span class="n">qb</span><span class="o">.</span><span class="n">create_ODE_system</span><span class="p">(</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    dx = a*x - b*x*y</span>
<span class="sd">    dy = -c*y + d*x*y</span>
<span class="sd">    &quot;&quot;&quot;</span><span class="p">,</span>
<span class="n">constants</span><span class="o">=</span> <span class="p">{</span><span class="s2">&quot;a&quot;</span><span class="p">:</span> <span class="mf">0.1</span><span class="p">,</span> <span class="s2">&quot;c&quot;</span><span class="p">:</span> <span class="mf">0.3</span><span class="p">},</span>
<span class="n">parameters</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;b&quot;</span><span class="p">:</span> <span class="mf">0.02</span><span class="p">,</span> <span class="s2">&quot;d&quot;</span><span class="p">:</span> <span class="mf">0.01</span><span class="p">},</span>
<span class="n">states</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;x&quot;</span><span class="p">:</span> <span class="mf">0.5</span><span class="p">,</span> <span class="s2">&quot;y&quot;</span><span class="p">:</span> <span class="mf">0.3</span><span class="p">},</span>
<span class="n">name</span><span class="o">=</span><span class="s2">&quot;LotkaVolterra&quot;</span><span class="p">,</span>
<span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">LV</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>In the above example, we’ve also provided default values for the parameters and
constants, and default initial values for the states. This is optional, we could
just provide a list or tuple of variable names instead, but it makes it a little
easier to specify which variables you’re “batching” over when you come to solve
the system.</p>
<p>There’s one more type of variable that we can specify: observables. Observables
are the results of auxiliary equations in your problem that you might want to
record the results of, but they’re calculated anew at each time step rather than
carrying a state between iterations like a state. For a trivial example, we
could define our Lotka-Volterra system with an observable that tracks the
predator’s death rate:</p>
<div class="literal-block-wrapper docutils container" id="id3">
<div class="code-block-caption"><span class="caption-text">Creating a system of ODEs with constants.</span><a class="headerlink" href="#id3" title="Link to this code"></a></div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">cubie</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">qb</span>

<span class="n">LV</span> <span class="o">=</span> <span class="n">qb</span><span class="o">.</span><span class="n">create_ODE_system</span><span class="p">(</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    predator_death_rate = c*y</span>
<span class="sd">    dx = a*x - b*x*y</span>
<span class="sd">    dy = -predator_death_rate + d*x*y</span>
<span class="sd">    &quot;&quot;&quot;</span><span class="p">,</span>
<span class="n">constants</span><span class="o">=</span> <span class="p">{</span><span class="s2">&quot;a&quot;</span><span class="p">:</span> <span class="mf">0.1</span><span class="p">,</span> <span class="s2">&quot;c&quot;</span><span class="p">:</span> <span class="mf">0.3</span><span class="p">},</span>
<span class="n">parameters</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;b&quot;</span><span class="p">:</span> <span class="mf">0.02</span><span class="p">,</span> <span class="s2">&quot;d&quot;</span><span class="p">:</span> <span class="mf">0.01</span><span class="p">},</span>
<span class="n">states</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;x&quot;</span><span class="p">:</span> <span class="mf">0.5</span><span class="p">,</span> <span class="s2">&quot;y&quot;</span><span class="p">:</span> <span class="mf">0.3</span><span class="p">},</span>
<span class="n">observables</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;predator_death_rate&quot;</span><span class="p">],</span>
<span class="n">name</span><span class="o">=</span><span class="s2">&quot;LotkaVolterra&quot;</span><span class="p">,</span>
<span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">LV</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>If we didn’t define predator_death_rate as an observable, Cubie would treat it
as an anonymous auxiliary variable, used on the way to the results we want but
not worth keeping. This behaviour applies to <em>all</em> left-hand side assignments
that do not target known states or listed observables: the variables still
participate in the symbolic expressions, but they are stored only as anonymous
auxiliaries and their trajectories are not saved.</p>
<section id="cubie-ode-system-glossary">
<h2>Cubie ODE System Glossary<a class="headerlink" href="#cubie-ode-system-glossary" title="Link to this heading"></a></h2>
<ul class="simple">
<li><p><em>States</em>: The variables that are being solved for. Each state variable must
have a (frac{dx}{dt}) equation. Each state variable must also have an
initial value, which sets the starting point of the initial value problem.</p></li>
<li><p><em>Parameters</em>: Input variables that are not solved for. These set the behaviour
of the system, and in Cubie, they are one of the two inputs that can be
“batched”, i.e. we can solve many IVPs with different parameter sets
simultaneously.</p></li>
<li><p><em>Constants</em>: Input variables that are not solved for, and do not change
between IVPs in a single batch. You can still change constants between
batches, but it will add a little overhead as the CUDA machine recompiles the
problem. Any parameters which will not change in a certain batch should be
moved to constants, as this will speed up the solving process.</p></li>
<li><p><em>Observables</em>: Also called auxiliary variables. These variables that are not
solved for, but are derived from the state inputs and parameters. These
typically pop up on the way to the (frac{dx}{dt}) equations, and might
represent physical quantities of interest in the system. Any state variables
that don’t have a (frac{dx}{dt}) equation should be moved into observables.</p></li>
<li><p><em>Drivers</em>: Also called forcing terms. These are time-dependent inputs to the
system. Cubie currently only supports one set of drivers per batch (i.e. all
IVPs use the same driver), but this can be worked around by parameterising the
driver function and passing a time vector as the driver function.</p></li>
</ul>
</section>
<section id="jacobians">
<h2>Jacobians<a class="headerlink" href="#jacobians" title="Link to this heading"></a></h2>
<p>Implicit algorithms, such as the RadauIIA5 method that Cubie uses, require the
system’s Jacobian. For why, see <a class="reference internal" href="algorithms.html#implicit-methods"><span class="std std-ref">Implicit Methods</span></a>.
Some widely-available solvers obtain this numerically by finite differences,
which is prone to error and instability, especially for stiff systems. Some
solvers use auto-differentiation, a clever way to get exact derivatives
efficiently. Cubie does not currently support auto-differentiation, but instead
generates the required Jacobian functions symbolically, with some manual
chain-rule steps that bring it closer to auto-differentiation and make it
faster. The process isn’t quick for big systems, but once it’s been done once,
it’s cached in a generated file in your working directory. You’ve only got to
pay the Jacobian tax once, unless you change some equations or constants, in
which case the system needs to generate everything again.</p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="index.html" class="btn btn-neutral float-left" title="User Manual" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="drivers.html" class="btn btn-neutral float-right" title="Drivers (Time-dependent functions)" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2025, Chris Cameron.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>